server:
  port: 8060

spring:
  application:
    name: skch-gateway-service

  cloud:
    gateway:
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials

      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: "*"
            allowedMethods: "*"
            allowedHeaders: "*"

      routes:

        # ==========================================================
        # API SERVICE ROUTE (backend runs on 8062)
        # ==========================================================
        - id: api-service
          uri: http://localhost:8062
          predicates:
            - Path=/api/**
          filters:
            - CircuitBreaker=name=apiCircuitBreaker,fallbackUri=forward:/fallback/api


        # ==========================================================
        # SWAGGER UI + API DOCS ROUTING (NO PREFIX)
        # ==========================================================

        # Swagger UI HTML + JS/CSS files
        - id: swagger-ui
          uri: http://localhost:8062
          predicates:
            - Path=/swagger-ui/**, /swagger-ui.html
          filters:
            - RewritePath=/(?<segment>.*), /${segment}

        # OpenAPI JSON + swagger-config
        - id: swagger-docs
          uri: http://localhost:8062
          predicates:
            - Path=/v3/api-docs/**, /swagger-resources/**, /webjars/**
          filters:
            - RewritePath=/(?<segment>.*), /${segment}


        # ==========================================================
        # AUTH SERVICE ROUTE (backend runs on 8061)
        # ==========================================================
        - id: oauth2-service
          uri: http://localhost:8061
          predicates:
            - Path=/auth/**
          filters:
            - StripPrefix=1


    # Enable load-balancer for future microservices
    loadbalancer:
      enabled: true


  # ==================================================
  # JWT VALIDATION SETTINGS
  # ==================================================
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://localhost:8061/realms/skch


  # ==================================================
  # REDIS CONFIG (optional for rate-limiting)
  # ==================================================
  data:
    redis:
      host: localhost
      port: 6379


# ==================================================
# LOGGING SETTINGS
# ==================================================
logging:
  level:
    root: INFO
    org.springframework.cloud.gateway: DEBUG
